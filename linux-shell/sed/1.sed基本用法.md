# 1 sed æ˜¯ä»€ä¹ˆï¼Ÿ

- è‹±æ–‡ï¼šstream editor
- sed æ˜¯<span style="color:red">éäº¤äº’å¼çš„è¡Œå¤„ç†</span>ç¼–è¾‘å™¨
- sed æ˜¯æœ€æ—©å¼€å§‹æ”¯æŒ<span style="color:red">æ­£åˆ™è¡¨è¾¾å¼</span>çš„å·¥å…·ä¹‹ä¸€

# 2 sed æœ‰å•¥ç”¨ï¼Ÿ

- å¢:
  - åœ¨åŒ¹é…çš„æ•°æ®è¡Œåé¢è¿½åŠ æ–‡æœ¬å†…å®¹
  - åœ¨åŒ¹é…çš„æ•°æ®è¡Œå‰é¢æ’å…¥æ–‡æœ¬å†…å®¹
- åˆ 
  - åˆ é™¤åŒ¹é…çš„æ•°æ®è¡Œæ•´è¡Œå†…å®¹ï¼ˆè¡Œåˆ é™¤ï¼‰
- æ”¹
  - å°†åŒ¹é…çš„æ•°æ®è¡Œæ•´è¡Œå†…å®¹æ›¿æ¢ä¸ºç‰¹å®šçš„æ–‡æœ¬å†…å®¹
  - ä»å¦ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–æ•°æ®å¹¶è¿½åŠ åˆ°åŒ¹é…çš„æ•°æ®è¡Œåé¢
  - å°†å½“å‰åŒ¹é…åˆ°çš„æ•°æ®å†™å…¥å¦ä¸€ä¸ªçš„æ–‡ä»¶ä¸­
- æŸ¥
  - æ ¹æ®è¡Œå·åŒ¹é…æ•°æ®
  - ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ•°æ®è¡Œ

# 3 sed æ€ä¹ˆç”¨ï¼Ÿ

- ä¸¤ç§ç”¨æ³• (æ ¹æ®æ–‡æœ¬æµçš„æ¥æºåˆ’åˆ†):
  - ç®¡é“æµæ–¹å¼(P15-16):
    ```
    å‘½ä»¤ | sed [é€‰é¡¹] 'åŒ¹é…æ¡ä»¶å’Œæ“ä½œæŒ‡ä»¤'
    free | sed -n '2p'
    ```
  - æ–‡ä»¶æµæ–¹å¼
    ```
    sed [é€‰é¡¹] 'åŒ¹é…æ¡ä»¶å’Œæ“ä½œæŒ‡ä»¤' è¾“å…¥æ–‡ä»¶...
    sed -n '2p' /etc/hosts
    ```

## 3.1 æŸ¥

### å‰ç½®çŸ¥è¯†

- çŸ¥è¯†ç‚¹
  - é‡å®šå‘
  - åŒ¿åç®¡é“
  - å‘½åç®¡é“
- æ“ä½œ
  - æŸ¥çœ‹ /etc/passwd å†…å®¹
  - æŸ¥çœ‹ /etc/passwd æ–‡ä»¶çš„å‰åè¡Œ
  - æŸ¥çœ‹ /etc/passwd æ–‡ä»¶çš„æœ€ååè¡Œ
  - è§£é‡Š /etc/passwd å†…å®¹
  - æ˜¾ç¤º /etc/passwd å†…å®¹æ˜¯å¸¦ä¸Šè¡Œå·
  - å¤åˆ¶ /etc/paaswd å†…å®¹ + è¡Œå·é‡å®šå‘è‡³ /tmp/passwd

### ç”¨æ³•è®²è§£

- æ— æ¡ä»¶

  - å¯ç”¨é»˜è®¤è¾“å‡ºåŠŸèƒ½

    ```
    [zhui@centos7-vm Downloads]$ sed 'p' /etc/hosts
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

    [zhui@centos7-vm ~]$ sed 'l' /etc/hosts
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.loc\
    aldomain4$
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    ::1         localhost localhost.localdomain localhost6 localhost6.loc\
    aldomain6$
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
    ```

  - å±è”½é»˜è®¤è¾“å‡ºåŠŸèƒ½

    ```
    [zhui@centos7-vm Downloads]$ sed -n 'p' /etc/hosts
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

    [zhui@centos7-vm ~]$ sed -n 'l' /etc/hosts
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.loc\
    aldomain4$
    ::1         localhost localhost.localdomain localhost6 localhost6.loc\
    aldomain6$
    ```

- è¡Œå·è¿‡æ»¤

  - æ­£è¿‡æ»¤è¯­æ³•
    - å•è¡Œæ•°æ®: `sed -n '3p' /tmp/passwd`
    - æŸå‡ è¡Œæ•°æ®: `sed -n '1p;5p;9p' /tmp/passwd`
    - æœ€åä¸€è¡Œæ•°æ®: ` sed -n '$p' /tmp/passwd`
    - åŒºé—´è¡Œæ•°æ®: `sed -n '3,10p' /tmp/passwd`
    - ç¬¬ N è¡Œè‡³æœ«å°¾è¡Œæ•°æ®: `sed -n '30,$p' /tmp/passwd`
    - èµ·å§‹è¡Œå·+æ­¥é•¿è¡Œæ•°æ®: `sed -n '3~3p' /tmp/passwd`
    - èµ·å§‹è¡Œå·+åç»­ N è¡Œæ•°æ®: `sed -n '10,+5p' /tmp/passwd`
  - åè¿‡æ»¤è¯­æ³•
    - é™¤å»ç¬¬ N è¡Œå¤– è¡Œæ•°æ®:`sed -n '3!p' /tmp/passwd`
    - é™¤å»åŒºé—´å¤– è¡Œæ•°æ®:`sed -n '10,20!p' /tmp/passwd `
    - é™¤å»èµ·å§‹è¡Œå·+æ­¥é•¿å¤– è¡Œæ•°æ®: `sed -n '1~5!p' /tmp/passwd`
  - æ€è€ƒé¢˜ ğŸ¤”
    - æ˜¾ç¤ºç¬¬ 20 è¡Œè‡³æœ«å°¾è¡Œ
    - ä»ç¬¬ä¸€è¡Œå¼€å§‹,æ¯éš” 10 è¡Œæ˜¾ç¤ºä¸€è¡Œæ•°æ®
    - æ˜¾ç¤ºé™¤ç¬¬ 10~30 è¡Œå¤–çš„æ‰€æœ‰è¡Œæ•°æ®

- æ­£åˆ™è¿‡æ»¤

  - æ ‡å‡†æ­£åˆ™è¿‡æ»¤:

    ```
    # å†™æ³•ä¸€ï¼š
    sed -n '/^http/p' /etc/services

    # å†™æ³•äºŒï¼šå­—ç¬¦#å¯ä»¥æ›¿æ¢æˆä»»æ„å­—ç¬¦
    sed -n '\#^http#p' /etc/services
    ```

  - æ‰©å±•æ­£åˆ™è¿‡æ»¤:

    ```
    # å†™æ³•ä¸€ï¼š
    sed -rn '/^(icmp|igmp)/p' /etc/services

    # å†™æ³•äºŒï¼šå­—ç¬¦#å¯ä»¥æ›¿æ¢æˆä»»æ„å­—ç¬¦
    sed -rn '\#^(icmp|igmp)#p' /etc/services
    ```

  - æ€è€ƒé¢˜ ğŸ¤”: å¦‚ä½•é€šè¿‡ cat + grep å‘½ä»¤å®ç°ä»¥ä¸Šè¿‡æ»¤

- è¡Œå·+æ­£åˆ™è¿‡æ»¤
  - æµ‹è¯•æ–‡ä»¶ï¼š /etc/services
  - æ¦‚å¿µè§£é‡Šï¼š`è¡Œå·è¿‡æ»¤æ¡ä»¶ { æ­£åˆ™è¿‡æ»¤æ¡ä»¶/p }`
  - ç¤ºä¾‹ä»£ç ï¼šæŸ¥æ‰¾ 1 ï½ 1500 è¡Œå†…ä»¥ icmp æˆ– igmp å¼€å§‹çš„è¡Œæ•°æ®
    ```
    [zhui@centos7-vm ~]$ sed -rn '1,1500{/^(icmp|igmp)/p}' /etc/services
    igmpv3lite      465/udp                 # IGMP over UDP for SSM
    ```
  - æ€è€ƒé¢˜ ğŸ¤”ï¼šæŸ¥æ‰¾ 1500 è¡Œè‡³æ–‡æ¡£æœ«å°¾ä¸­ï¼Œä»¥ icmp æˆ– igmp å¼€å§‹çš„è¡Œæ•°æ®

## 3.2 åˆ 

### å‰ç½®çŸ¥è¯†

- ä¸ä¿®æ”¹æºæ–‡ä»¶ï¼Œåªè¾“å‡ºåˆ é™¤åçš„ç»“æœ
  ```
  [zhui@centos7-vm Downloads]$ cat -n /etc/passwd > /tmp/passwd
  [zhui@centos7-vm Downloads]$ sed '2d' /tmp/passwd
       1	root:x:0:0:root:/root:/bin/bash
       3	daemon:x:2:2:daemon:/sbin:/sbin/nologin
       4	adm:x:3:4:adm:/var/adm:/sbin/nologin
       ......
  [zhui@centos7-vm Downloads]$ cat /tmp/passwd
       1	root:x:0:0:root:/root:/bin/bash
       2	bin:x:1:1:bin:/bin:/sbin/nologin
       3	daemon:x:2:2:daemon:/sbin:/sbin/nologin
       ......
  ```
- åªä¿®æ”¹æºæ–‡ä»¶ä¸å¤‡ä»½:
  ```
  [zhui@centos7-vm ~]$ cat -n /etc/passwd > /tmp/passwd
  [zhui@centos7-vm ~]$ sed -i '2d' /tmp/passwd
  [zhui@centos7-vm ~]$ cat /tmp/passwd
      1	root:x:0:0:root:/root:/bin/bash
      3	daemon:x:2:2:daemon:/sbin:/sbin/nologin
      4	adm:x:3:4:adm:/var/adm:/sbin/nologin
      ......
  ```
- æ—¢ä¿®æ”¹æºæ–‡ä»¶åˆå¤‡ä»½:
  ```
  [zhui@centos7-vm ~]$ cat -n /etc/passwd > /tmp/passwd
  [zhui@centos7-vm ~]$ sed -i.bak '2d' /tmp/passwd
  [zhui@centos7-vm ~]$ cat /tmp/passwd
       1	root:x:0:0:root:/root:/bin/bash
       3	daemon:x:2:2:daemon:/sbin:/sbin/nologin
       4	adm:x:3:4:adm:/var/adm:/sbin/nologin
       ......
  [zhui@centos7-vm ~]$ cat /tmp/passwd.bak
       1	root:x:0:0:root:/root:/bin/bash
       2	bin:x:1:1:bin:/bin:/sbin/nologin
       3	daemon:x:2:2:daemon:/sbin:/sbin/nologin
       4	adm:x:3:4:adm:/var/adm:/sbin/nologin
  ```

### ç”¨æ³•è®²è§£

- æ ¹æ®è¡Œå·åˆ é™¤
  - åˆ é™¤æŸä¸€è¡Œæ•°æ®: `sed -i.bak '2d' /tmp/passwd`
  - åˆ é™¤æŸä¸ªåŒºé—´çš„è¡Œæ•°æ®ï¼š`sed -i.bak '2,10d' /tmp/passwd`
  - æ€è€ƒé¢˜ ğŸ¤”ï¼š åˆ é™¤å¥‡æ•°è¡Œæ•°æ®(/tmp/passwd)
- æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼åˆ é™¤
  - åˆ é™¤ä»¥ bash ç»“å°¾çš„è¡Œæ•°æ®ï¼š `sed -i.bak '/bash$/d' /tmp/passwd`
  - æ€è€ƒé¢˜ ğŸ¤”ï¼š
    - åˆ é™¤ç”¨æˆ·åä¸­å¸¦å­—ç¬¦ o çš„è¡Œæ•°æ®ï¼Ÿ
    - æç¤ºï¼š æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªå†’å·å‰çš„æ˜¯ç”¨æˆ·å

## 3.3 å¢

- å¢åŠ è¡Œæ•°æ®
  - åŒ¹é…è¡Œæ•°æ®çš„å‰ä¸€è¡Œæ’å…¥æ•°æ®(insert)
    - è¡Œå·åŒ¹é…ï¼šåœ¨ç¬¬ä¸€è¡Œå‰æ’å…¥æ•°æ®
      ```
      [zhui@centos7-vm ~]$ cp /etc/hosts /tmp/
      [zhui@centos7-vm ~]$ cat /tmp/hosts
      127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
      ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
      [zhui@centos7-vm ~]$ sed -i '1i add new line' /tmp/hosts
      [zhui@centos7-vm ~]$ cat /tmp/hosts
      add new line
      127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
      ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
      ```
    - æ­£åˆ™åŒ¹é…ï¼šåœ¨ localhost6 çš„å‰ä¸€è¡Œæ’å…¥æ•°æ®
      - ç¤ºä¾‹ä»£ç ï¼š
        ```
        [zhui@centos7-vm ~]$ cp /etc/hosts /tmp/
        [zhui@centos7-vm ~]$ sed -i '/localhost6/i add new line' /tmp/hosts
        [zhui@centos7-vm ~]$ cat /tmp/hosts
        127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
        add new line
        ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
        ```
      - æ€è€ƒé¢˜ ğŸ¤”ï¼šå‡å¦‚/tmp/hosts æœ‰å¤šè¡Œæ•°æ®åŒ…å« localhost6ï¼Œé‚£ä¹ˆè¿è¡Œç»“æœä¼šæœ‰æ€æ ·ï¼Ÿ
  - åŒ¹é…è¡Œæ•°æ®çš„åä¸€è¡Œæ’å…¥æ•°æ®(append)

## 3.4 æ”¹

### å‰ç½®çŸ¥è¯†

- å¤åˆ¶ /etc/hosts æ–‡ä»¶ï¼š`cp /etc/hosts /tmp`

### ç”¨æ³•è®²è§£

- æ›¿æ¢è¡Œæ•°æ®
  - æ›¿æ¢æ‰€æœ‰è¡Œæ•°æ®ï¼š`sed 'c all modity' /tmp/hosts`
  - æ›¿æ¢æŒ‡å®šè¡Œæ•°æ®ï¼š`sed '2c modify line' /tmp/hosts`
  - æ›¿æ¢æ­£åˆ™åŒ¹é…çš„è¡Œæ•°æ®ï¼Œç»Ÿä¸€ä¿®æ”¹åŒ…å« localhost6 çš„è¡Œæ•°æ®ï¼š
    ```
    [zhui@centos7-vm ~]$ cat /etc/hosts > /tmp/hosts
    [zhui@centos7-vm ~]$ cat /tmp/hosts
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
    [zhui@centos7-vm ~]$ sed '/localhost6/c are you okay?' /tmp/hosts
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    are you okay?
    ```
- æ›¿æ¢å­—ç¬¦ä¸²
  - æµ‹è¯•æ–‡ä»¶ test.txt
    ```
    hello the world, hello Hunan
    go spurs go
    123 456 789
    hello the beijing
    I am Jacob
    ```
  - æ— è¿‡æ»¤æ›¿æ¢
    - æ›¿æ¢æ¯ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªç›®æ ‡å­—ç¬¦ä¸²
      ```
      [zhui@centos7-vm Downloads]$ sed 's/hello/hi/' test.txt
      hi the world, hello Hunan
      go spurs go
      123 456 789
      hi the beijing
      I am Jacob
      ```
    - æ›¿æ¢æ¯ä¸€è¡Œçš„ç¬¬ N ä¸ªç›®æ ‡å­—ç¬¦ä¸²: æ›¿æ¢æ¯è¡Œçš„ç¬¬äºŒä¸ª hello
      ```
      [zhui@centos7-vm Downloads]$ sed 's/hello/hi/2' test.txt
      hello the world, hi Hunan
      go spurs go
      123 456 789
      hello the beijing
      I am Jacob
      ```
    - æ›¿æ¢æ¯ä¸€è¡Œçš„æ‰€æœ‰ç›®æ ‡å­—ç¬¦ä¸²:
      ```
      [zhui@centos7-vm Downloads]$ sed 's/hello/hi/g' test.txt
      hi the world, hi Hunan
      go spurs go
      123 456 789
      hi the beijing
      I am Jacob
      ```
  - è¡Œå·è¿‡æ»¤æ›¿æ¢
    ```
    # åœ¨1ï½3è¡Œä¸­ï¼Œå°†ç¬¬ä¸€ä¸ªhelloæ›¿æ¢æˆhi
    [zhui@centos7-vm Downloads]$ sed '1,3{s/hello/hi/}' test.txt
    hi the world, hello Hunan
    go spurs go
    123 456 789
    hello the beijing
    I am Jacob
    ```
  - æ­£åˆ™è¿‡æ»¤æ›¿æ¢
    - æ­£åˆ™æ›¿æ¢
      ```
      # ä»¥ingç»“å°¾çš„è¡Œæ•°æ®ä¸­ï¼Œå°†helloæ›¿æ¢æˆhi
      [zhui@centos7-vm Downloads]$ sed '/ing$/s/hello/hi/' test.txt
      hello the world, hello Hunan
      go spurs go
      123 456 789
      hi the beijing
      I am Jacob
      ```
    - ä½ç½®å¯¹è°ƒ
      ```
      [zhui@centos7-vm Downloads]$ sed -r 's/^(.)(.*)(.)$/\3\2\1/' test.txt
      nello the world, hello Hunah
      oo spurs gg
      923 456 781
      gello the beijinh
      b am JacoI
      ```
    - æ€è€ƒé¢˜ ğŸ¤”
      - å°† test.txt ä¸­çš„ `123 456 789` å¯¹æ‰æˆ `789 456 123`
      - å°† /tmp/passwd ä¸­æ¯è¡Œçš„ç”¨æˆ·åç»Ÿä¸€æ”¹æˆ nobody
